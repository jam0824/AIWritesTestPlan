# 変更箇所および影響範囲に基づくテスト観点一覧

このドキュメントは、2025-06 セッションで実施した実装／リファクタリングに対して、主に変更箇所とそこから波及すると考えられる影響範囲にフォーカスしたテスト観点を網羅的に列挙したものです。

---

## 目次
1. ボス再実装（Boss Queen／Boss Middle Gastaroid／Egg）
2. インタフェース & 基底クラスの更新（`IEnemy`／`BaseEnemy`）
3. 新武器システム：Cluster Battery
4. 共通コンポーネント修正
5. プレハブ・アセット改修
6. 回帰テスト & パフォーマンス

---

## 1. ボス再実装（Boss Queen／Boss Middle Gastaroid／Egg）
### 1.1 機能テスト
- [ ] スクロール速度との同期
  - StageManager が加減速してもボスの Z 移動が追従するか
- [ ] 攻撃パターン遷移
  - Move → Tail-Attack → Jump-Attack → Roar の順序・条件／確率
  - Tail-Attack での Egg 生成数・位置・タイミング
- [ ] ジャンプ攻撃
  - 飛翔軌道、着地判定、着地時ダメージ／エフェクト発火
- [ ] 咆哮（Roar）
  - プレイヤー被弾判定、SE/BGM のフェード
- [ ] HP バー＆BGM
  - 出現時フェードイン、撃破後フェードアウト
  - BGM ループ、切替えタイミング
- [ ] 移動境界
  - minZ / maxZ 到達時の停止・反転
- [ ] プレイヤー追従回転
  - 角速度制限、近距離高速旋回時のブレ

### 1.2 エッグ (`Egg.cs`) テスト
- [ ] 落下 → 着地 → 孵化 のステート遷移
- [ ] Rigidbody / Collider の切替え正当性
- [ ] 孵化後敵生成（`GrowToMiddleGastaroid`）
- [ ] ダメージ計算（HP、無敵時間）
- [ ] スクロール追従、背景加算速度の上書き
- [ ] スコア・アイテムドロップ

### 1.3 影響範囲
- 旧ボスクラスの無参照保証
- エッグ生成数増加による負荷・GC スパイク
- Spawner／EnemyManager への登録・解除

---

## 2. インタフェース & 基底クラスの更新（`IEnemy`／`BaseEnemy`）
### 2.1 機能テスト
- [ ] `Item` プロパティの Get/Set とドロップ制御
- [ ] 旧 `item` フィールド参照コードのコンパイルエラー確認
- [ ] 既存敵 Prefab の MissingField/MissingScript チェック

### 2.2 影響範囲
- すべての敵派生クラス
- ドロップロジック（GameManager, ItemSpawner）

---

## 3. 新武器システム：Cluster Battery
### 3.1 バッテリー基本動作
- [ ] 自動連射コルーチン開始／停止タイミング
- [ ] 武器レベルごとの連射レート・`bulletRound` 反映
- [ ] 発射方向：Y +90° 回転補正

### 3.2 Cluster Main Bomb (`ClusterMainBomb.cs`)
- 投下 & 加速度
  - [ ] 重力落下開始速度、前方加速値の適用
  - [ ] Y 減速 → 上向き推力への推移曲線
- シェル分離
  - [ ] 0.2s 後の外殻排出とトルク
  - [ ] 外殻の自動破棄タイミング
- 弾幕生成
  - [ ] 0.1s ごとの下向き散弾角度（-90° ±10°）
  - [ ] `bulletRound` が増えた際の散弾数スケール
- エフェクト & SE
  - [ ] Back-fire エフェクト位置・再生タイミング
  - [ ] 爆発 SE 多重再生制御

### 3.3 Cluster Children Bomb (`ClusterChildrenBomb.cs`)
- [ ] 地面付近での爆発判定（Raycast 高さ・遅延）
- [ ] 爆発ダメージ範囲とノックバック

### 3.4 影響範囲
- プレイヤーバッテリー切替 UI
- `PlayerCore` プレハブの WeaponSlot 参照
- 弾幕大量生成による FPS 低下

---

## 4. 共通コンポーネント修正
### 4.1 `ConfigPlayerBullet.clearHitEnemyList()`
- [ ] Bullet 破棄直前にリストがクリアされるか
- [ ] 多重ヒット防止ロジックとの整合

---

## 5. プレハブ・アセット改修
- [ ] `GameManager.prefab` の ClusterBattery 設定
- [ ] `PlayerCore.prefab` の BatterySlot 参照切替
- [ ] 新規マテリアル／スプライトの Import 設定 (Compression, Filter)
- [ ] 各 Prefab に Missing Script がないか

---

## 6. 回帰テスト & パフォーマンス
### 6.1 回帰テスト
- [ ] 既存武器（Laser, Homing など）の射撃／当たり判定
- [ ] 旧ステージボス戦の挙動保持

### 6.2 パフォーマンステスト
- [ ] Peak FPS（大量 Egg + ClusterBomb 弾幕）
- [ ] GC Alloc / Frame < 3 KB 指標
- [ ] モバイルビルドでの温度上昇・バッテリ消費

---

## 付録：リスク優先度マトリクス
| 項目 | インパクト | 発生確率 | 優先度 |
|------|-----------|-----------|---------|
| ClusterBomb 大量弾幕による FPS 低下 | 高 | 中 | A |
| ボス攻撃遷移バグで進行不可 | 高 | 低 | A |
| `Item` プロパティ未設定による Null | 中 | 中 | B |
| 外殻シェル未破棄でオブジェクトリーク | 中 | 低 | B |
| BGM 切替え漏れによる無音 | 低 | 中 | C |

---

> **備考**: 本ドキュメントは QA チームがテスト設計書を作成する際の観点リストとして利用してください。各観点の詳細手順・テストデータは別途ケース仕様書に落とし込みます。 