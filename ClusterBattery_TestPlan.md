# ClusterBatteryシステム テスト計画書

## 概要
本ドキュメントは、Unity VampSTG2プロジェクトに新規追加されたClusterBatteryシステムの包括的なテスト計画を定義します。

### 対象システム
- ClusterBattery.cs（メイン武器クラス）
- ClusterMainBomb.cs（主弾丸ロジック）
- ClusterChildrenBomb.cs（子弾丸ロジック）
- 関連プレファブ・アセット・UI統合

### テスト実行環境
- Unity Editor 2022.3以上
- Windows 10/11
- 最小システム要件での動作確認も含む

---

## 1. ユニットテストレベル

### 1.1 ClusterBattery.cs テスト

#### 1.1.1 基本機能テスト

**TC-U001: クラス継承テスト**
- **目的**: BaseBatteryからの正しい継承確認
- **手順**:
  1. ClusterBatteryインスタンスを生成
  2. BaseBatteryのメソッド・プロパティがアクセス可能か確認
  3. virtual/overrideメソッドが正しく動作するか検証
- **期待結果**: 継承関係が正常に機能し、基底クラスの機能が利用可能
- **重要度**: 高

**TC-U002: 初期化パラメータテスト**
- **目的**: 初期化時のパラメータ設定確認
- **手順**:
  1. Start()メソッド呼び出し前後の状態確認
  2. 発射間隔、威力、弾薬数の初期値検証
  3. null参照エラーの有無確認
- **期待結果**: 全パラメータが仕様通りに初期化される
- **重要度**: 高

**TC-U003: 発射間隔制御テスト**
- **目的**: クールダウン機能の正確性確認
- **手順**:
  1. Fire()メソッドを連続呼び出し
  2. 設定間隔以下での発射が無視されることを確認
  3. クールダウン経過後の正常発射を確認
- **期待結果**: 設定された発射間隔が正確に守られる
- **重要度**: 高

**TC-U004: 弾薬管理テスト**
- **目的**: 弾薬数制限の正しい動作確認
- **手順**:
  1. 弾薬を最大数まで発射
  2. 弾薬0時の発射試行
  3. 弾薬補給後の発射再開
- **期待結果**: 弾薬数が正確に管理され、0時は発射されない
- **重要度**: 中

#### 1.1.2 境界値テスト

**TC-U005: 発射間隔境界値テスト**
- **目的**: 最大・最小発射間隔での安定動作確認
- **手順**:
  1. 発射間隔を0.001秒に設定してテスト
  2. 発射間隔を10秒に設定してテスト
  3. 負の値・0値設定時の動作確認
- **期待結果**: 極端な値でも安定動作し、適切なデフォルト値に補正される
- **重要度**: 中

**TC-U006: メモリリークテスト**
- **目的**: 長時間使用時のメモリ安定性確認
- **手順**:
  1. 1000回連続発射実行
  2. メモリ使用量の推移監視
  3. ガベージコレクション頻度の測定
- **期待結果**: メモリ使用量が安定し、重大なリークが発生しない
- **重要度**: 中

### 1.2 ClusterMainBomb.cs テスト

#### 1.2.1 物理挙動テスト

**TC-U007: 初期速度・方向テスト**
- **目的**: 発射時の物理パラメータ正確性確認
- **手順**:
  1. 様々な角度・速度で弾丸生成
  2. Rigidbody.velocityの値確認
  3. 実際の飛行軌道と計算値の比較
- **期待結果**: 設定された初期速度・方向通りに弾丸が飛行
- **重要度**: 高

**TC-U008: 重力・物理法則適用テスト**
- **目的**: Unity物理エンジンとの正しい連携確認
- **手順**:
  1. 重力設定を変更して弾丸挙動確認
  2. 空気抵抗・摩擦係数の影響測定
  3. 物理マテリアル設定の反映確認
- **期待結果**: Unity物理設定に従った自然な弾道
- **重要度**: 中

#### 1.2.2 分離ロジックテスト

**TC-U009: 分離トリガー条件テスト**
- **目的**: 分離条件の正確な判定確認
- **手順**:
  1. 時間経過による分離テスト
  2. 飛行距離による分離テスト
  3. 敵・障害物衝突による分離テスト
- **期待結果**: 設定された条件で確実に分離が実行される
- **重要度**: 高

**TC-U010: 子弾丸生成パラメータテスト**
- **目的**: 分離時の子弾丸配置・数量確認
- **手順**:
  1. 分離時の子弾丸生成数確認
  2. 各子弾丸の配置角度・速度測定
  3. 親弾丸の位置・速度継承確認
- **期待結果**: 仕様通りの数・配置で子弾丸が生成される
- **重要度**: 高

**TC-U011: 分離後処理テスト**
- **目的**: メイン弾丸の適切な破棄確認
- **手順**:
  1. 分離実行後のメイン弾丸状態確認
  2. GameObject.Destroy()の実行確認
  3. 参照残りによるメモリリーク確認
- **期待結果**: メイン弾丸が確実に破棄され、リソースが解放される
- **重要度**: 中

#### 1.2.3 エラーハンドリングテスト

**TC-U012: 子弾丸プレファブ未設定テスト**
- **目的**: 設定不備時の安全な動作確認
- **手順**:
  1. 子弾丸プレファブをnullに設定
  2. 分離処理実行
  3. エラーログ・例外の確認
- **期待結果**: NullReferenceExceptionが発生せず、適切なエラーハンドリング
- **重要度**: 中

### 1.3 ClusterChildrenBomb.cs テスト

#### 1.3.1 個別動作テスト

**TC-U013: 生成時初期化テスト**
- **目的**: 子弾丸の正しい初期化確認
- **手順**:
  1. 親弾丸からの初期パラメータ継承確認
  2. 独自パラメータの設定確認
  3. 物理コンポーネントの初期状態確認
- **期待結果**: 全パラメータが適切に初期化される
- **重要度**: 高

**TC-U014: ライフタイム管理テスト**
- **目的**: 子弾丸の生存時間管理確認
- **手順**:
  1. 最大生存時間での自動破棄確認
  2. 早期破棄条件での動作確認
  3. タイマー精度の検証
- **期待結果**: 設定時間で確実に破棄される
- **重要度**: 中

#### 1.3.2 衝突・ダメージテスト

**TC-U015: 敵衝突検出テスト**
- **目的**: 正確な衝突判定確認
- **手順**:
  1. 様々なサイズの敵との衝突テスト
  2. 高速移動時の衝突検出精度確認
  3. 複数敵同時衝突の処理確認
- **期待結果**: 全ての有効な衝突が正確に検出される
- **重要度**: 高

**TC-U016: ダメージ計算テスト**
- **目的**: ダメージ値の正確な計算・適用確認
- **手順**:
  1. 基本ダメージ値の適用確認
  2. クリティカル・属性ダメージの計算確認
  3. 敵の防御力との相互作用確認
- **期待結果**: 仕様通りのダメージが敵に適用される
- **重要度**: 高

---

## 2. 結合テストレベル

### 2.1 プレイヤーシステム統合

#### 2.1.1 武器切り替えテスト

**TC-I001: 武器切り替えフローテスト**
- **目的**: 他武器からClusterBatteryへの切り替え動作確認
- **手順**:
  1. 別武器を装備した状態からClusterBatteryに切り替え
  2. 切り替え中の入力処理確認
  3. 切り替え完了時の状態確認
- **期待結果**: スムーズな武器切り替えが実現される
- **重要度**: 高

**TC-I002: 切り替え中弾丸状態管理テスト**
- **目的**: 切り替え時の既存弾丸処理確認
- **手順**:
  1. 弾丸発射中に武器切り替え実行
  2. 既存弾丸の継続飛行確認
  3. 新武器での発射準備状態確認
- **期待結果**: 既存弾丸は継続し、新武器が正常に準備される
- **重要度**: 中

**TC-I003: UI表示同期テスト**
- **目的**: 武器切り替え時のUI更新確認
- **手順**:
  1. 武器アイコン・名前の表示更新確認
  2. 弾薬表示の正確な更新確認
  3. クールダウン表示の同期確認
- **期待結果**: UI表示が即座に正確に更新される
- **重要度**: 中

#### 2.1.2 PlayerCore連携テスト

**TC-I004: 入力処理連携テスト**
- **目的**: プレイヤー入力からの発射指令伝達確認
- **手順**:
  1. キーボード・マウス・ゲームパッド入力での発射確認
  2. 入力遅延・レスポンス時間測定
  3. 同時入力時の処理確認
- **期待結果**: 全入力デバイスで即座に反応する
- **重要度**: 高

**TC-I005: 弾薬管理システム連携テスト**
- **目的**: プレイヤーの弾薬システムとの統合確認
- **手順**:
  1. アイテム収集による弾薬補給確認
  2. 弾薬上限・下限の管理確認
  3. 複数武器間での弾薬独立性確認
- **期待結果**: 弾薬システムが正確に連携する
- **重要度**: 高

### 2.2 弾丸システム統合

#### 2.2.1 ConfigPlayerBullet連携テスト

**TC-I006: 弾丸設定読み込みテスト**
- **目的**: 設定ファイルからの正しい読み込み確認
- **手順**:
  1. ConfigPlayerBullet.csの設定値読み込み確認
  2. ランタイムでの設定変更反映確認
  3. 無効な設定値時のデフォルト処理確認
- **期待結果**: 設定が正確に読み込まれ適用される
- **重要度**: 中

**TC-I007: 他弾丸種別との競合回避テスト**
- **目的**: 他武器の弾丸設定との独立性確認
- **手順**:
  1. 複数武器同時使用時の設定独立性確認
  2. 設定変更時の他武器への影響確認
  3. メモリ使用量の最適化確認
- **期待結果**: 他武器に影響を与えない独立動作
- **重要度**: 中

#### 2.2.2 弾丸プール管理テスト

**TC-I008: オブジェクトプール効率テスト**
- **目的**: 弾丸オブジェクトの効率的な再利用確認
- **手順**:
  1. 大量発射時のプール使用状況確認
  2. プールサイズの動的調整確認
  3. メモリ断片化の防止確認
- **期待結果**: 効率的なオブジェクト再利用が実現される
- **重要度**: 中

### 2.3 ゲームオブジェクト相互作用

#### 2.3.1 敵システム連携テスト

**TC-I009: 敵ダメージ適用テスト**
- **目的**: 敵システムへの正確なダメージ適用確認
- **手順**:
  1. 様々な敵タイプへのダメージ適用確認
  2. 敵のHP減少・撃破処理確認
  3. ダメージ計算式の正確性確認
- **期待結果**: 全ての敵に正確なダメージが適用される
- **重要度**: 高

**TC-I010: スコア・アイテム処理テスト**
- **目的**: 敵撃破時の報酬システム連携確認
- **手順**:
  1. 敵撃破時のスコア加算確認
  2. アイテムドロップ処理確認
  3. 特殊効果・ボーナスの適用確認
- **期待結果**: 撃破報酬が正確に付与される
- **重要度**: 中

#### 2.3.2 エフェクトシステム連携テスト

**TC-I011: 視覚効果同期テスト**
- **目的**: 発射・爆発エフェクトの同期確認
- **手順**:
  1. 発射時のマズルフラッシュ表示確認
  2. 弾丸衝突時の爆発エフェクト確認
  3. エフェクト表示タイミングの精度確認
- **期待結果**: 全エフェクトが適切なタイミングで表示される
- **重要度**: 中

**TC-I012: 音響効果連携テスト**
- **目的**: サウンド再生との同期確認
- **手順**:
  1. 発射音の再生タイミング確認
  2. 爆発音の3D位置音響確認
  3. 音量・ピッチ設定の反映確認
- **期待結果**: 適切な音響効果が同期して再生される
- **重要度**: 低

---

## 3. システムテストレベル

### 3.1 ゲームプレイ統合テスト

#### 3.1.1 実戦使用シナリオテスト

**TC-S001: 通常ステージ実用性テスト**
- **目的**: 一般的なゲームプレイでの有効性確認
- **手順**:
  1. Stage1-3での実戦使用
  2. 雑魚敵群への効果確認
  3. プレイヤーの使い勝手評価
- **期待結果**: 通常プレイで有効な武器として機能する
- **重要度**: 高

**TC-S002: ボス戦有効性テスト**
- **目的**: ボス戦での戦術的価値確認
- **手順**:
  1. 各ボスとの戦闘でのダメージ効率確認
  2. ボスの弱点部位への攻撃効果確認
  3. 攻撃パターンとの相性確認
- **期待結果**: ボス戦で戦術的価値を持つ
- **重要度**: 高

**TC-S003: 多様な敵配置対応テスト**
- **目的**: 様々な戦況への適応性確認
- **手順**:
  1. 密集敵群への効果確認
  2. 分散敵への攻撃効率確認
  3. 高速移動敵への命中率確認
- **期待結果**: 多様な戦況に適応できる
- **重要度**: 中

#### 3.1.2 ゲームバランステスト

**TC-S004: 他武器との威力バランステスト**
- **目的**: 武器間の威力バランス適正性確認
- **手順**:
  1. DPS（秒間ダメージ）の他武器との比較
  2. 弾薬効率の比較評価
  3. 使用場面での優位性・劣位性確認
- **期待結果**: 他武器と適正なバランスを保つ
- **重要度**: 高

**TC-S005: ゲーム難易度への影響評価テスト**
- **目的**: 新武器追加による難易度変化確認
- **手順**:
  1. 既存ステージのクリア時間変化測定
  2. プレイヤーの死亡率変化確認
  3. スコア獲得効率の変化確認
- **期待結果**: ゲーム難易度が適正に保たれる
- **重要度**: 中

### 3.2 パフォーマンステスト

#### 3.2.1 負荷テスト

**TC-S006: 大量弾丸負荷テスト**
- **目的**: 同時存在弾丸数上限での安定性確認
- **手順**:
  1. 最大弾丸数（100発以上）同時存在状態作成
  2. フレームレート測定
  3. メモリ使用量監視
  4. 入力レスポンス測定
- **期待結果**: 60FPS以上を維持し、応答性を保つ
- **重要度**: 高

**TC-S007: 長時間プレイ安定性テスト**
- **目的**: 連続プレイでのメモリリーク・パフォーマンス劣化確認
- **手順**:
  1. 2時間連続でClusterBattery使用
  2. メモリ使用量の経時変化確認
  3. フレームレート安定性確認
  4. 発熱・CPU使用率監視
- **期待結果**: 長時間プレイでも安定したパフォーマンス
- **重要度**: 中

#### 3.2.2 最適化検証テスト

**TC-S008: オブジェクトプール効率テスト**
- **目的**: 弾丸プールによるパフォーマンス向上確認
- **手順**:
  1. プール使用時・未使用時のパフォーマンス比較
  2. メモリ割り当て頻度の測定
  3. ガベージコレクション発生頻度確認
- **期待結果**: プール使用により明確なパフォーマンス向上
- **重要度**: 中

### 3.3 アイテムシステム統合テスト

#### 3.3.1 収集・装備フローテスト

**TC-S009: ItemClusterBattery収集テスト**
- **目的**: アイテムとしての収集・管理システム確認
- **手順**:
  1. フィールドでのアイテム出現確認
  2. プレイヤーによる収集処理確認
  3. インベントリへの追加確認
- **期待結果**: アイテムシステムと完全に統合される
- **重要度**: 高

**TC-S010: 装備・解除フローテスト**
- **目的**: 武器装備システムとの統合確認
- **手順**:
  1. メニューからの装備選択・変更
  2. 装備中の他武器への切り替え
  3. 装備解除時の状態管理
- **期待結果**: スムーズな装備管理が可能
- **重要度**: 中

### 3.4 クロスプラットフォーム対応テスト

#### 3.4.1 プラットフォーム互換性テスト

**TC-S011: Windows環境テスト**
- **目的**: Windows各バージョンでの動作確認
- **手順**:
  1. Windows 10/11での動作確認
  2. 異なるハードウェア構成での確認
  3. DirectX/OpenGLでの動作比較
- **期待結果**: 全Windows環境で安定動作
- **重要度**: 高

**TC-S012: 解像度・アスペクト比対応テスト**
- **目的**: 様々な画面設定での表示・操作確認
- **手順**:
  1. 1080p/1440p/4K解像度での表示確認
  2. 16:9/21:9/4:3アスペクト比での動作確認
  3. UI要素の適切な配置確認
- **期待結果**: 全解像度・アスペクト比で適切に表示
- **重要度**: 中

---

## 4. テスト実行管理

### 4.1 テスト環境設定

#### 4.1.1 最小動作環境
- OS: Windows 10 (64bit)
- CPU: Intel Core i3-8100 / AMD Ryzen 3 2200G
- RAM: 8GB
- GPU: GTX 1050 / RX 560
- DirectX: Version 11

#### 4.1.2 推奨動作環境
- OS: Windows 11 (64bit)
- CPU: Intel Core i5-10400 / AMD Ryzen 5 3600
- RAM: 16GB
- GPU: RTX 3060 / RX 6600
- DirectX: Version 12

### 4.2 テスト実行スケジュール

| フェーズ | 期間 | 担当 | 備考 |
|---------|------|------|------|
| ユニットテスト | 2日 | 開発者 | 全機能実装完了後 |
| 結合テスト | 3日 | QAチーム | システム統合後 |
| システムテスト | 5日 | QA+プレイテスター | 全機能統合後 |
| 回帰テスト | 2日 | QAチーム | バグ修正後 |

### 4.3 テスト報告

#### 4.3.1 レポート項目
- 実行テストケース数
- 合格/不合格数
- 発見バグ数・重要度別分類
- パフォーマンス測定結果
- 推奨改善事項

#### 4.3.2 合格基準
- **クリティカル**: 0件
- **メジャー**: 2件以下
- **マイナー**: 10件以下
- **フレームレート**: 60FPS以上維持
- **メモリリーク**: 2時間で500MB以下の増加

---

## 5. リスク管理

### 5.1 高リスク項目
1. **物理演算の精度**: Unity物理エンジンとの競合
2. **メモリ管理**: 大量オブジェクト生成によるリーク
3. **パフォーマンス**: 低スペック環境での動作

### 5.2 対応策
- 早期プロトタイプでの動作検証
- プロファイラーによる定期的な監視
- 複数環境での並行テスト実施

---

## 6. 付録

### 6.1 テストデータ
- テスト用敵配置データ
- パフォーマンステスト用シナリオ
- 境界値テスト用パラメータセット

### 6.2 ツール・スクリプト
- 自動テスト実行スクリプト
- パフォーマンス測定ツール
- テスト結果集計スクリプト

---

**作成日**: 2024年12月19日  
**版数**: 1.0  
**承認者**: プロジェクトマネージャー 